<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="cap_assets_frontend" inherit_id="website.assets_frontend">
        <xpath expr="link[last()]" position="after">
            <link rel="stylesheet" type="text/scss" href="/cap_website_products_attributes_design/static/src/scss/website_sale_attribute_selection.scss" />
            <link rel="stylesheet" type="text/scss" href="/cap_website_products_attributes_design/static/src/scss/style.scss"/>
        </xpath>
        <xpath expr="script[last()]" position="after">
            <script type="text/javascript" src="/cap_website_products_attributes_design/static/src/js/variant_mixin.js"/>
        </xpath>
    </template>

    <template id="cap_assets_backend" inherit_id="website.assets_backend" name="assets backend">
        <xpath expr="link[last()]" position="after">
            <link rel="stylesheet" type="text/scss" href="/cap_website_products_attributes_design/static/src/scss/style.scss"/>
        </xpath>
    </template>

    <template id="cap_product_attributes_product" name="Product" inherit_id="website_sale.product">
        <xpath expr="//section[@id='product_detail']/div[2]/div[1]" position="inside">
            <t t-if="product.builder_visible">
                <div class="row" id="click_variant">
                    <t t-foreach="product.valid_product_template_attribute_line_ids" t-as="ptal">
                        <t t-if="ptal.attribute_id.display_type == 'color'">
                            <div class="text-center attribute-handle-length">
                                <h2>Select a <strong t-field="ptal.attribute_id.name" class="attribute_name"/></h2>
                                <div class="attribute-selector__description hidden-xs">
                                    <span t-field="ptal.attribute_id.x_studio_custom_description"/>
                                </div>
                                <div class="row row-eq-height">
                                    <t t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptav">
                                        <div class="col-xs-4 js_attribute_value">
                                            <a href="#" t-attf-class="btn btn-default attribute-selector forbtn btn-default attribute-selector m-control js_variant_change #{ptal.attribute_id.create_variant} #{'d-none' if single_and_custom else ''} #{'selected' if ptav in combination else ''}"
                                               role="button" t-att-data-attribute_id="ptal.attribute_id.id" t-att-data-attribute_value="ptav.id" style="width: 200px;">
                                                <div class="attribute-selector__name" t-attf-style="background-color:#{ptav.html_color or ptav.product_attribute_value_id.name if not ptav.is_custom else ''};border:1px black solid">
                                                    <span t-attf-style="background-color:#{ptav.html_color or ptav.product_attribute_value_id.name if not ptav.is_custom else ''}"
                                                          t-attf-class="css_attribute_color #{'active' if ptav in combination else ''} #{'custom_value' if ptav.is_custom else ''}"/>
                                                </div>
                                                <div class="attribute-selector__description hidden-xs">
                                                    <span class="badge badge-pill badge-secondary" t-if="ptav.price_extra" style="font-size: 100%;background: #bb3c99;">
                                                        <!-- see note above about price_extra -->
                                                        <t t-esc="ptav.price_extra > 0 and '+' or '-'"/>
                                                        <span t-esc="abs(ptav.price_extra)" class="variant_price_extra" style="white-space: nowrap;"
                                                              t-options='{
                                                            "widget": "monetary",
                                                            "from_currency": product.currency_id,
                                                            "display_currency": (pricelist or product).currency_id
                                                        }'/>
                                                    </span>
                                                </div>
                                                <div class="attribute-selector__description hidden-xs">
                                                    <span t-esc="ptav.product_attribute_value_id.x_studio_text_in_box"/>
                                                </div>
                                            </a>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>
                        <t t-elif="ptal.attribute_id.display_type == 'upload_image'">
                            <div class="text-center attribute-handle-length">
                                <h2>Select a <strong t-field="ptal.attribute_id.name" class="attribute_name"/></h2>
                                <div class="attribute-selector__description hidden-xs">
                                    <span t-field="ptal.attribute_id.x_studio_custom_description"/>
                                </div>
                                <div class="row row-eq-height">
                                    <t t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptav">
                                        <div class="col-xs-6 js_attribute_value">
                                            <a href="#" t-attf-class="btn btn-default attribute-selector form-control js_variant_change #{ptal.attribute_id.create_variant} #{'d-none' if single_and_custom else ''} #{'selected' if ptav in combination else ''}"
                                               role="button" t-att-data-attribute_id="ptal.attribute_id.id" t-att-data-attribute_value="ptav.id">
                                                <t t-set="lesson_image" t-value="website.image_url(ptav, 'upload_image_value')"/>
                                                <div class="attribute-bundle__image attribute-bundle__image--grey"
                                                     t-attf-style="background-image: url(#{lesson_image});"/>
                                                <div class="attribute-bundle__content">
                                                    <div class="attribute-selector__name hidden-xs hidden-sm">
                                                        <span t-field="ptav.name"/>
                                                    </div>
                                                    <div class="attribute-selector__description hidden-xs">
                                                        <span class="badge badge-pill badge-secondary" t-if="ptav.price_extra" style="font-size: 100%;background: #bb3c99;">
                                                            <!-- see note above about price_extra -->
                                                            <t t-esc="ptav.price_extra > 0 and '+' or '-'"/>
                                                            <span t-esc="abs(ptav.price_extra)" class="variant_price_extra" style="white-space: nowrap;"
                                                                  t-options='{
                                                            "widget": "monetary",
                                                            "from_currency": product.currency_id,
                                                            "display_currency": (pricelist or product).currency_id
                                                        }'/>
                                                        </span>
                                                    </div>
                                                    <div class="attribute-selector__description hidden-xs">
                                                        <span t-esc="ptav.product_attribute_value_id.x_studio_text_in_box"/>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>
                        <t t-else="">
                            <div class="text-center attribute-handle-length">
                                <h2>Select a <strong t-field="ptal.attribute_id.name" class="attribute_name"/></h2>
                                <div class="attribute-selector__description hidden-xs">
                                    <span t-field="ptal.attribute_id.x_studio_custom_description"/>
                                </div>
                                <div class="row row-eq-height">
                                    <t t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptav">
                                        <div class="col-xs-4 js_attribute_value">
                                            <a href="#" t-attf-class="btn btn-default attribute-selector forbtn btn-default attribute-selectorm-control js_variant_change #{ptal.attribute_id.create_variant} #{'d-none' if single_and_custom else ''} #{'selected' if ptav in combination else ''}"
                                               role="button" t-att-data-attribute_id="ptal.attribute_id.id" t-att-data-attribute_value="ptav.id">
                                                <div class="attribute-selector__name">
                                                    <span t-field="ptav.name"/>
                                                </div>
                                                <div class="attribute-selector__description hidden-xs">
                                                    <span class="badge badge-pill badge-secondary" t-if="ptav.price_extra" style="font-size: 100%;background: #bb3c99;">
                                                        <!-- see note above about price_extra -->
                                                        <t t-esc="ptav.price_extra > 0 and '+' or '-'"/>
                                                        <span t-esc="abs(ptav.price_extra)" class="variant_price_extra" style="white-space: nowrap;"
                                                              t-options='{
                                                            "widget": "monetary",
                                                            "from_currency": product.currency_id,
                                                            "display_currency": (pricelist or product).currency_id
                                                        }'/>
                                                    </span>
                                                </div>
                                                <div class="attribute-selector__description hidden-xs">
                                                    <span t-esc="ptav.product_attribute_value_id.x_studio_text_in_box"/>
                                                </div>
                                            </a>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>
                    </t>
                </div>
            </t>
        </xpath>
        <xpath expr="//div[@id='product_details']" position="attributes">
            <attribute name="t-att-style">'background-color:#FFF;margin-left: 50px;border: 1px solid grey;position: fixed;left: 61vw;right: 10vw;bottom: 0em;top: 11em;z-index: 999;overflow: auto;width: 30vw;' if product.builder_visible else ''</attribute>
        </xpath>
    </template>

    <template id="variant_inherit" inherit_id="sale.variants">
        <xpath expr="//li[@t-att-data-attribute_id='ptal.attribute_id.id']" position="inside">
            <t t-if="ptal.attribute_id.display_type == 'upload_image'">
                <ul t-att-data-attribute_id="ptal.attribute_id.id" t-attf-class="list-inline  #{'d-none' if single_and_custom else ''}">
                    <li t-foreach="ptal.product_template_value_ids._only_active()" t-as="ptav" class="list-inline-item" style="line-height:0px;width: 13%;height: 51px;">
                        <label t-attf-class="css_attribute_color #{'active' if ptav in combination else ''} #{'custom_value' if ptav.is_custom else ''}" style="max-width:30px;max-height:29px;">
                            <img id="zoom_custom" t-attf-src="data:image/*;base64,{{ptav.upload_image_value}}" style="width: 20px;     height: 22px;" t-att-title="ptav.name" data-toggle="tooltip"/>
                            <input type="radio" style="display:none;" t-attf-class="js_variant_change  #{ptal.attribute_id.create_variant}" t-att-checked="ptav in combination" t-att-name="'ptal-%s' % ptal.id" t-att-value="ptav.id" t-att-title="ptav.name" t-att-data-value_id="ptav.id" t-att-data-value_name="ptav.name" t-att-data-attribute_name="ptav.attribute_id.name" t-att-data-is_custom="ptav.is_custom" t-att-data-is_single_and_custom="single_and_custom"/>
                        </label>
                        <a t-esc="ptav.name" class="display_text" style="display:none;" />
                    </li>
                </ul>
            </t>
        </xpath>
    </template>

</odoo>
